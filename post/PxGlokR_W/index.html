<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">

<title>7usai</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

<meta name="description" content="7usai&#39;blog"/>
<meta name="keywords" content="7usai&#39;blog"/>

<!-- Place favicon.ico and apple-touch-icon.png in the root directory -->
<link rel="shortcut icon" href="https://7usai.github.io/favicon.ico">

<link rel="stylesheet" href="https://7usai.github.io/styles/main.css">

<!-- Modernizr JS -->
<script src="https://7usai.github.io/media/scripts/modernizr-2.6.2.min.js"></script>
<!-- FOR IE9 below -->
<!--[if lt IE 9]>
<scripts src="https://7usai.github.io/media/scripts/respond.min.js"></scripts>
<![endif]-->

<!-- Comment -->



<!-- katex -->
<!--<link href="https://cdn.bootcss.com/KaTeX/0.11.1/katex.min.css" rel="stylesheet">-->

<link href="https://cdn.bootcss.com/font-awesome/5.11.2/css/all.min.css" rel="stylesheet">



</head>
<body>
    <div id="fh5co-offcanvas">
    <a href="#!" class="fh5co-close-offcanvas js-fh5co-close-offcanvas">
        <span><i class="icon-cross3"></i> <span>Close</span></span>
    </a>
    <div class="fh5co-bio">
        <figure>
            <img src="https://7usai.github.io/images/avatar.png" alt="7usai"
                 class="img-responsive">
        </figure>
        <a href="https://7usai.github.io/post/about/"><h3 class="heading">ABOUT ME</h3></a>
        <h2>7usai</h2>
        <p>7usai&#39;blog</p>
        <ul class="fh5co-social">
            
                <li>
                    
                        <a href="https://github.com/7usai" target="_blank">
                            <i class="fab fa-github"></i>
                        </a>
                    
                </li>
            
                <li>
                    
                </li>
            
                <li>
                    
                </li>
            
                <li>
                    
                </li>
            
                <li>
                    
                </li>
            
        </ul>
    </div>

    <div class="fh5co-menu">

        <!-- 标签 -->
        <div class="fh5co-box">
            <a href="https://7usai.github.io/tags/"><h3 class="heading">👉标签</h3></a>
            <ul>
                
                    <li><a href="https://7usai.github.io/tag/wwBiS2Ka3/">ctf</a></li>
                
                    <li><a href="https://7usai.github.io/tag/7xbgN0lBu/">二进制</a></li>
                
                    <li><a href="https://7usai.github.io/tag/htgQPxP7v/">漏洞利用</a></li>
                
                    <li><a href="https://7usai.github.io/tag/1gI_7hVyP/">知识</a></li>
                
                    <li><a href="https://7usai.github.io/tag/_wk3DR6W6/">CTF</a></li>
                
                    <li><a href="https://7usai.github.io/tag/eUcnOz4Tr/">转载</a></li>
                
                    <li><a href="https://7usai.github.io/tag/TEP_9-KfN/">C++</a></li>
                
                    <li><a href="https://7usai.github.io/tag/XKOVycb-9/">语言</a></li>
                
                    <li><a href="https://7usai.github.io/tag/lGYs_sz42/">web</a></li>
                
                    <li><a href="https://7usai.github.io/tag/dcphGguTG/">开发</a></li>
                
            </ul>
        </div>
    </div>
</div>

<header id="fh5co-header">
    <div class="container-fluid">
        <div class="row">
            <a href="#" class="js-fh5co-nav-toggle fh5co-nav-toggle"><i></i></a>
            <ul class="fh5co-social">
                
                    <li>
                        <a href="/"
                        
                        >
                            首页
                        </a>
                    </li>
                
                    <li>
                        <a href="/archives"
                        
                        >
                            归档
                        </a>
                    </li>
                
                    <li>
                        <a href="/tags"
                        
                        >
                            标签
                        </a>
                    </li>
                
                    <li>
                        <a href="/post/about"
                        
                        >
                            关于
                        </a>
                    </li>
                
            </ul>
            <div class="col-lg-12 col-md-12 text-center">
                <h1 id="fh5co-logo">
                    <a href="https://7usai.github.io">7usai </a>
                </h1>
            </div>
        </div>
    </div>
</header>


    <!--  <a href="#" class="fh5co-post-prev"><span>👈 Prev</span></a>-->
    <!--  <a href="#" class="fh5co-post-next"><span>Next 👉</span></a>-->

    <!-- 等gridea出自定义页面功能再优化一下 -->
    
        <div class="container-fluid">
    <div class="row fh5co-post-entry single-entry">
        <article class="col-lg-8 col-lg-offset-2 col-md-8 col-md-offset-2 col-sm-8 col-sm-offset-2 col-xs-12 col-xs-offset-0">
            <figure class="animate-box">
                
                    <img src="https://7usai.github.io/post-images/PxGlokR_W.jpg" alt="BUUCTF re部分wp_3" class="img-responsive">
                
            </figure>
            <span class="fh5co-meta animate-box">
                
                    <div class="tag-container">
                        
                            <a href="https://7usai.github.io/tag/wwBiS2Ka3/" class="tag">ctf, </a>
                        
                            <a href="https://7usai.github.io/tag/7xbgN0lBu/" class="tag">二进制, </a>
                        
                    </div>
                
            </span>
            <h2 class="fh5co-article-title animate-box">BUUCTF re部分wp_3</h2>
            <ol class="breadcrumb fh5co-meta fh5co-date animate-box" style="margin-bottom:0; background-color:#f8f9fa">
                <li>2020-10-14</li>
                <li>3858字</li>
                <li>23 min read</li>
            </ol>

            <div class="col-lg-12 col-lg-offset-0 col-md-12 col-md-offset-0 col-sm-12 col-sm-offset-0 col-xs-12 col-xs-offset-0 text-left content-article">
                <div class="row">
                    <div class="col-md-12 animate-box post-content">
                        <p> <h2 id="guet-ctf2019re">[GUET-CTF2019]re</h2>
<p>发现有upx壳，脱壳机脱壳失败，使用upx-d脱壳</p>
<p>找到主函数</p>
<pre><code>int __cdecl main(int argc, const char **argv, const char **envp)
{
  const char *v3; // rdi
  int result; // eax
  __int64 v5; // rdx
  unsigned __int64 v6; // rt1
  __int64 v7; // [rsp+0h] [rbp-30h]
  __int64 v8; // [rsp+8h] [rbp-28h]
  __int64 v9; // [rsp+10h] [rbp-20h]
  __int64 v10; // [rsp+18h] [rbp-18h]
  unsigned __int64 v11; // [rsp+28h] [rbp-8h]

  v11 = __readfsqword(0x28u);
  v7 = 0LL;
  v8 = 0LL;
  v9 = 0LL;
  v10 = 0LL;
  sub_40F950((unsigned __int64)&quot;input your flag:&quot;);
  sub_40FA80((unsigned __int64)&quot;%s&quot;);
  if ( (unsigned int)sub_4009AE((char *)&amp;v7) )
  {
    v3 = &quot;Correct!&quot;;
    sub_410350((__int64)&quot;Correct!&quot;);
  }
  else
  {
    v3 = &quot;Wrong!&quot;;
    sub_410350((__int64)&quot;Wrong!&quot;);
  }
  result = 0;
  v6 = __readfsqword(0x28u);
  v5 = v6 ^ v11;
  if ( v6 != v11 )
    sub_443550(v3, &amp;v7, v5);
  return result;
}
</code></pre>
<p>关键函数sub_4009AE</p>
<pre><code>_BOOL8 __fastcall sub_4009AE(char *a1)
{
  if ( 1629056 * *a1 != 166163712 )
    return 0LL;
  if ( 6771600 * a1[1] != 731332800 )
    return 0LL;
  if ( 3682944 * a1[2] != 357245568 )
    return 0LL;
  if ( 10431000 * a1[3] != 1074393000 )
    return 0LL;
  if ( 3977328 * a1[4] != 489211344 )
    return 0LL;
  if ( 5138336 * a1[5] != 518971936 )
    return 0LL;
  if ( 7532250 * a1[7] != 406741500 )
    return 0LL;
  if ( 5551632 * a1[8] != 294236496 )
    return 0LL;
  if ( 3409728 * a1[9] != 177305856 )
    return 0LL;
  if ( 13013670 * a1[10] != 650683500 )
    return 0LL;
  if ( 6088797 * a1[11] != 298351053 )
    return 0LL;
  if ( 7884663 * a1[12] != 386348487 )
    return 0LL;
  if ( 8944053 * a1[13] != 438258597 )
    return 0LL;
  if ( 5198490 * a1[14] != 249527520 )
    return 0LL;
  if ( 4544518 * a1[15] != 445362764 )
    return 0LL;
  if ( 3645600 * a1[17] != 174988800 )
    return 0LL;
  if ( 10115280 * a1[16] != 981182160 )
    return 0LL;
  if ( 9667504 * a1[18] != 493042704 )
    return 0LL;
  if ( 5364450 * a1[19] != 257493600 )
    return 0LL;
  if ( 13464540 * a1[20] != 767478780 )
    return 0LL;
  if ( 5488432 * a1[21] != 312840624 )
    return 0LL;
  if ( 14479500 * a1[22] != 1404511500 )
    return 0LL;
  if ( 6451830 * a1[23] != 316139670 )
    return 0LL;
  if ( 6252576 * a1[24] != 619005024 )
    return 0LL;
  if ( 7763364 * a1[25] != 372641472 )
    return 0LL;
  if ( 7327320 * a1[26] != 373693320 )
    return 0LL;
  if ( 8741520 * a1[27] != 498266640 )
    return 0LL;
  if ( 8871876 * a1[28] != 452465676 )
    return 0LL;
  if ( 4086720 * a1[29] != 208422720 )
    return 0LL;
  if ( 9374400 * a1[30] == 515592000 )
    return 5759124 * a1[31] == 719890500;
  return 0LL;
}
</code></pre>
<p>脚本</p>
<pre><code>a=[166163712,731332800,357245568,1074393000]
b=[1629056,6771600,3682944,10431000]
c=''
for i in range(len(a)):
    c+=chr(int(a[i]/b[i]))
print(c)

from z3 import *
s = Solver()
a1 = [0]*32
for i in range(32):
    a1[i] = Int('a1['+str(i)+']')

s.add( 1629056 * a1[0] == 166163712 )
s.add( 6771600 * a1[1] == 731332800 )
s.add( 3682944 * a1[2] == 357245568 )
s.add( 10431000 * a1[3] == 1074393000 )
s.add( 3977328 * a1[4] == 489211344 )
s.add( 5138336 * a1[5] == 518971936 )
s.add( 7532250 * a1[7] == 406741500 )
s.add( 5551632 * a1[8] == 294236496 )
s.add( 3409728 * a1[9] == 177305856 )
s.add( 13013670 * a1[10] == 650683500 )
s.add( 6088797 * a1[11] == 298351053 )
s.add( 7884663 * a1[12] == 386348487 )
s.add( 8944053 * a1[13] == 438258597 )
s.add( 5198490 * a1[14] == 249527520 )
s.add( 4544518 * a1[15] == 445362764 )
s.add( 3645600 * a1[17] == 174988800 )
s.add( 10115280 * a1[16] == 981182160 )
s.add( 9667504 * a1[18] == 493042704 )
s.add( 5364450 * a1[19] == 257493600 )
s.add( 13464540 * a1[20] == 767478780 )
s.add( 5488432 * a1[21] == 312840624 )
s.add( 14479500 * a1[22] == 1404511500 )
s.add( 6451830 * a1[23] == 316139670 )
s.add( 6252576 * a1[24] == 619005024 )
s.add( 7763364 * a1[25] == 372641472 )
s.add( 7327320 * a1[26] == 373693320 )
s.add( 8741520 * a1[27] == 498266640 )
s.add( 8871876 * a1[28] == 452465676 )
s.add( 4086720 * a1[29] == 208422720 )
s.add( 9374400 * a1[30] == 515592000 )
s.add(5759124 * a1[31] == 719890500)
s.check()
print(s.model())

a1=[0]*32
a1[31] = 125
a1[30] = 55
a1[29] = 51
a1[28] = 51
a1[27] = 57
a1[26] = 51
a1[25] = 48
a1[24] = 99
a1[23] = 49
a1[22] = 97
a1[21] = 57
a1[20] = 57
a1[19] = 48
a1[18] = 51
a1[16] = 97
a1[17] = 48
a1[15] = 98
a1[14] = 48
a1[13] = 49
a1[12] = 49
a1[11] = 49
a1[10] = 50
a1[9] = 52
a1[8] = 53
a1[7] = 54
a1[5] = 101
a1[4] = 123
a1[3] = 103
a1[2] = 97
a1[1] = 108
a1[0] = 102
d=''
for i in range(32):
    if i==6:
        continue
    d+=chr(a1[i])
    print(d)
</code></pre>
<p>先尝试前四位得到flag，猜测为flag，可以一个一个算，也可以省事使用z3，脚本如上，缺少a1[6]，一个一个试，从1到z，发现加个1就好</p>
<p>得flag=flag{e165421110ba03099a1c039337}</p>
<h2 id="flareon4login">[FlareOn4]login</h2>
<p>F12源代码</p>
<pre><code>&lt;!DOCTYPE Html /&gt;
&lt;html&gt;
    &lt;head&gt;
        &lt;title&gt;FLARE On 2017&lt;/title&gt;
    &lt;/head&gt;
    &lt;body&gt;
        &lt;input type=&quot;text&quot; name=&quot;flag&quot; id=&quot;flag&quot; value=&quot;Enter the flag&quot; /&gt;
        &lt;input type=&quot;button&quot; id=&quot;prompt&quot; value=&quot;Click to check the flag&quot; /&gt;
        &lt;script type=&quot;text/javascript&quot;&gt;
            document.getElementById(&quot;prompt&quot;).onclick = function () {
                var flag = document.getElementById(&quot;flag&quot;).value;
                var rotFlag = flag.replace(/[a-zA-Z]/g, function(c){return String.fromCharCode((c &lt;= &quot;Z&quot; ? 90 : 122) &gt;= (c = c.charCodeAt(0) + 13) ? c : c - 26);});
//将(c &lt;= &quot;Z&quot; ? 90 : 122) &gt;= (c = c.charCodeAt(0) + 13) ? c : c - 26)转为一个字符
charCodeAt() 方法可返回指定位置的字符的 Unicode 编码
b ? x : y b 操作数必须是一个布尔型的表达式，x 和 y 是任意类型的值。true,执行x
(c&lt;=&quot;Z&quot;执行Z否则z)&gt;=
                if (&quot;PyvragFvqrYbtvafNerRnfl@syner-ba.pbz&quot; == rotFlag) {
                    alert(&quot;Correct flag!&quot;);
                } else {
                    alert(&quot;Incorrect flag, rot again&quot;);
                }
            }
        &lt;/script&gt;
    &lt;/body&gt;
&lt;/html&gt;
</code></pre>
<p>分开大小写字母进行判断，相当于进行个13位移加密，直接凯撒密码就行</p>
<h2 id="actf新生赛2020rome">[ACTF新生赛2020]rome</h2>
<p>主函数</p>
<pre><code>int func()
{
  int result; // eax
  int v1; // [esp+14h] [ebp-44h]
  int v2; // [esp+18h] [ebp-40h]
  int v3; // [esp+1Ch] [ebp-3Ch]
  int v4; // [esp+20h] [ebp-38h]
  unsigned __int8 v5; // [esp+24h] [ebp-34h]
  unsigned __int8 v6; // [esp+25h] [ebp-33h]
  unsigned __int8 v7; // [esp+26h] [ebp-32h]
  unsigned __int8 v8; // [esp+27h] [ebp-31h]
  unsigned __int8 v9; // [esp+28h] [ebp-30h]
  int v10; // [esp+29h] [ebp-2Fh]
  int v11; // [esp+2Dh] [ebp-2Bh]
  int v12; // [esp+31h] [ebp-27h]
  int v13; // [esp+35h] [ebp-23h]
  unsigned __int8 v14; // [esp+39h] [ebp-1Fh]
  char v15; // [esp+3Bh] [ebp-1Dh]
  char v16; // [esp+3Ch] [ebp-1Ch]
  char v17; // [esp+3Dh] [ebp-1Bh]
  char v18; // [esp+3Eh] [ebp-1Ah]
  char v19; // [esp+3Fh] [ebp-19h]
  char v20; // [esp+40h] [ebp-18h]
  char v21; // [esp+41h] [ebp-17h]
  char v22; // [esp+42h] [ebp-16h]
  char v23; // [esp+43h] [ebp-15h]
  char v24; // [esp+44h] [ebp-14h]
  char v25; // [esp+45h] [ebp-13h]
  char v26; // [esp+46h] [ebp-12h]
  char v27; // [esp+47h] [ebp-11h]
  char v28; // [esp+48h] [ebp-10h]
  char v29; // [esp+49h] [ebp-Fh]
  char v30; // [esp+4Ah] [ebp-Eh]
  char v31; // [esp+4Bh] [ebp-Dh]
  int i; // [esp+4Ch] [ebp-Ch]

  v15 = 81;
  v16 = 115;
  v17 = 119;
  v18 = 51;
  v19 = 115;
  v20 = 106;
  v21 = 95;
  v22 = 108;
  v23 = 122;
  v24 = 52;
  v25 = 95;
  v26 = 85;
  v27 = 106;
  v28 = 119;
  v29 = 64;
  v30 = 108;
  v31 = 0;
  printf(&quot;Please input:&quot;);
  scanf(&quot;%s&quot;, &amp;v5);
  result = v5;
  if ( v5 == 'A' )
  {
    result = v6;
    if ( v6 == 'C' )
    {
      result = v7;
      if ( v7 == 'T' )
      {
        result = v8;
        if ( v8 == 'F' )
        {
          result = v9;
          if ( v9 == '{' )
          {
            result = v14;
            if ( v14 == '}' )                   // 中间一共16位字符
            {
              v1 = v10;
              v2 = v11;
              v3 = v12;
              v4 = v13;
              for ( i = 0; i &lt;= 15; ++i )
              {
                if ( *((_BYTE *)&amp;v1 + i) &gt; 64 &amp;&amp; *((_BYTE *)&amp;v1 + i) &lt;= 90 )// v1[i]为大写字母
                  *((_BYTE *)&amp;v1 + i) = (*((char *)&amp;v1 + i) - 51) % 26 + 65;
                if ( *((_BYTE *)&amp;v1 + i) &gt; 96 &amp;&amp; *((_BYTE *)&amp;v1 + i) &lt;= 122 )// v1[i]为小写字母
                  *((_BYTE *)&amp;v1 + i) = (*((char *)&amp;v1 + i) - 79) % 26 + 97;
              }
              for ( i = 0; i &lt;= 15; ++i )
              {
                result = (unsigned __int8)*(&amp;v15 + i);
                if ( *((_BYTE *)&amp;v1 + i) != (_BYTE)result )
                  return result;
              }
              result = printf(&quot;You are correct!&quot;);
            }
          }
        }
      }
    }
  }
  return result;
}
</code></pre>
<p>脚本</p>
<pre><code>result=[81,115,119,51,115,106,95,108,122,52,95,85,106,119,64,108]
v1=''
for i in range(len(result)):
    for j in range(127):
        a=j
        if j&gt;64 and j&lt;=90:
            j=(j-51)%26+65
        if j&gt;96 and j&lt;=122:
            j=(j-79)%26+97
        if j==result[i]:
            v1+=chr(a)
print(v1)
</code></pre>
<h2 id="vn2020-公开赛strangecpp">[V&amp;N2020 公开赛]strangeCpp</h2>
<p>main函数</p>
<pre><code>int __cdecl main(int argc, const char **argv, const char **envp)
{
  char *v3; // rdi
  signed __int64 i; // rcx
  __int64 v5; // rax
  __int64 v6; // rax
  __int64 v7; // rax
  __int64 v8; // rax
  char v10; // [rsp+0h] [rbp-20h]
  struct _SYSTEM_INFO SystemInfo; // [rsp+28h] [rbp+8h]
  __int64 *j; // [rsp+78h] [rbp+58h]
  __int64 v13; // [rsp+98h] [rbp+78h]
  const char **v14; // [rsp+1A0h] [rbp+180h]

  v14 = envp;
  v3 = &amp;v10;
  for ( i = 94i64; i; --i )
  {
    *v3 = -858993460;
    v3 += 4;
  }
  sub_1400110AA(&amp;unk_140027033);
  GetSystemInfo(&amp;SystemInfo);
  putchar(byte_140021004);
  putchar(byte_140021005);
  putchar(byte_140021006);
  putchar(byte_140021007);
  putchar(byte_140021019);
  putchar(byte_14002101A);
  putchar(byte_140021005);                      // welcome
  putchar(10);
  puts(&quot;Let me have a look at your computer...&quot;);
  for ( j = v14; *j; ++j )
  {
    v13 = *j;
    sub_140011226(&quot;%s\n&quot;, v13);
  }
  std::basic_ostream&lt;char,std::char_traits&lt;char&gt;&gt;::operator&lt;&lt;(std::cout, sub_140011127);
  dword_140021190 = SystemInfo.dwNumberOfProcessors;
  sub_140011226(&quot;now system cpu num is %d\n&quot;, SystemInfo.dwNumberOfProcessors);
  if ( dword_140021190 &lt; 8 )
  {
    puts(&quot;Are you in VM?&quot;);
    _exit(0);
  }
  if ( GetUserNameA(Str1, &amp;pcbBuffer) )
  {
    v5 = sub_140011172(std::cout, &quot;this is useful&quot;);
    std::basic_ostream&lt;char,std::char_traits&lt;char&gt;&gt;::operator&lt;&lt;(v5, sub_140011127);
  }
  v6 = std::basic_ostream&lt;char,std::char_traits&lt;char&gt;&gt;::operator&lt;&lt;(std::cout, sub_140011127);
  v7 = sub_140011172(v6, &quot;ok,I am checking...&quot;);
  std::basic_ostream&lt;char,std::char_traits&lt;char&gt;&gt;::operator&lt;&lt;(v7, sub_140011127);
  if ( !j_strcmp(Str1, &quot;cxx&quot;) )
  {
    v8 = sub_140011172(std::cout, &quot;flag{where_is_my_true_flag?}&quot;);
    std::basic_ostream&lt;char,std::char_traits&lt;char&gt;&gt;::operator&lt;&lt;(v8, sub_140011127);
    _exit(0);
  }
  system(&quot;pause&quot;);
  sub_1400113E3(&amp;v10, &amp;unk_14001DE50);
  return 0;
}
</code></pre>
<p>在存储welcome的字符中间有一个奇怪的字符串byte_140021008</p>
<pre><code>.data:0000000140021004 byte_140021004  db 'w'                  ; DATA XREF: main+59↑r
.data:0000000140021005 byte_140021005  db 'e'                  ; DATA XREF: main+68↑r
.data:0000000140021005                                         ; main+B3↑r
.data:0000000140021006 byte_140021006  db 'l'                  ; DATA XREF: main+77↑r
.data:0000000140021007 byte_140021007  db 'c'                  ; DATA XREF: main+86↑r
.data:0000000140021008 ; _BYTE byte_140021008[17]
.data:0000000140021008 byte_140021008  db 26h, 2Ch, 21h, 27h, 3Bh, 0Dh, 4, 75h, 68h, 34h, 28h
.data:0000000140021008                                         ; DATA XREF: sub_140013580+81↑o
.data:0000000140021008                 db 25h, 0Eh, 35h, 2Dh, 69h, 3Dh
.data:0000000140021019 byte_140021019  db 'o'                  ; DATA XREF: main+95↑r
.data:000000014002101A byte_14002101A  db 'm'                  ; DATA XREF: main+A4↑r
</code></pre>
<p>交叉引用进入</p>
<pre><code>__int64 sub_140013580()
{
  __int64 *v0; // rdi
  signed __int64 i; // rcx
  __int64 result; // rax
  __int64 v3; // [rsp+0h] [rbp-20h]
  int v4; // [rsp+24h] [rbp+4h]
  int j; // [rsp+44h] [rbp+24h]
  __int64 v6; // [rsp+128h] [rbp+108h]

  v0 = &amp;v3;
  for ( i = 82i64; i; --i )
  {
    *v0 = -858993460;
    v0 = (v0 + 4);
  }
  v6 = -2i64;
  sub_1400110AA(&amp;unk_140027033);
  result = sub_140011384(dword_140021190);
  v4 = result;
  if ( result == 607052314 &amp;&amp; dword_140021190 &lt;= 14549743 )
  {
    for ( j = 0; j &lt; 17; ++j )
    {
      putchar((dword_140021190 ^ byte_140021008[j]));// 0x26,0x2C,0x21, 0x27, 0x3B, 0x0D, 0x04, 0x75, 0x68,0x34, 0x28, 0x25,0x0E, 0x35, 0x2D, 0x69,0x3D
      result = (j + 1);
    }
  }
  return result;
}
</code></pre>
<p>可知是找一个dword_140021190，经过sub_140011384函数变化放入result后result==607052314并且dword_140021190&lt;=14549743，逆向出这个dword_140021190后再与byte_140021008异或后输出</p>
<p>脚本</p>
<pre><code>v7=0
for i in range(14549743):
    tmp=(((i&lt;&lt;8)^(i&gt;&gt;12))*291)&amp;0xffffffff#unsigned int 范围是0~0xFFFFFFFF
    if tmp==607052314:
        v7=i
        break
print(v7)
#爆破出v7值

flag=''
byte_140021008=[0x26,0x2C,0x21, 0x27, 0x3B, 0x0D, 0x04, 0x75, 0x68,0x34, 0x28, 0x25,0x0E, 0x35, 0x2D, 0x69,0x3D]
for i in range(len(byte_140021008)):
    flag+=chr((byte_140021008[i]^v7)&amp;0xFF)
    print(flag)

import hashlib
md = hashlib.md5()
md.update(str(v7).encode('utf-8'))
print (&quot;flag{&quot;+md.hexdigest()+&quot;}&quot;)
</code></pre>
<h2 id="bjdctf2020easy">[BJDCTF2020]easy</h2>
<p>关键函数</p>
<pre><code>int ques()
{
  int v0; // edx
  int result; // eax
  int v2[50]; // [esp+20h] [ebp-128h]
  int v3; // [esp+E8h] [ebp-60h]
  int v4; // [esp+ECh] [ebp-5Ch]
  int v5; // [esp+F0h] [ebp-58h]
  int v6; // [esp+F4h] [ebp-54h]
  int v7; // [esp+F8h] [ebp-50h]
  int v8; // [esp+FCh] [ebp-4Ch]
  int v9; // [esp+100h] [ebp-48h]
  int v10; // [esp+104h] [ebp-44h]
  int v11; // [esp+108h] [ebp-40h]
  int v12; // [esp+10Ch] [ebp-3Ch]
  int j; // [esp+114h] [ebp-34h]
  __int64 v14; // [esp+118h] [ebp-30h]
  int v15; // [esp+124h] [ebp-24h]
  int v16; // [esp+128h] [ebp-20h]
  int i; // [esp+12Ch] [ebp-1Ch]

  v3 = 0x7FFA7E31;
  v4 = 0x224FC;
  v5 = 0x884A4239;
  v6 = 0x22A84;
  v7 = 0x84FF235;
  v8 = 0x3FF87;
  v9 = 0x88424233;
  v10 = 0x23185;
  v11 = 0x7E4243F1;
  v12 = 0x231FC;
  for ( i = 0; i &lt;= 4; ++i )
  {
    memset(v2, 0, sizeof(v2));
    v16 = 0;
    v15 = 0;
    v0 = *(&amp;v4 + 2 * i);
    LODWORD(v14) = *(&amp;v3 + 2 * i);              // 取出无符号长整型参数的高16位。v3[2i]
    HIDWORD(v14) = v0;                          // 取出无符号长整型参数的低16位。v4[2i]
    while ( SHIDWORD(v14) &gt; 0 || v14 &gt;= 0 &amp;&amp; v14 )
    {
      v2[v16++] = ((SHIDWORD(v14) &gt;&gt; 31) ^ (((SHIDWORD(v14) &gt;&gt; 31) ^ v14) - (SHIDWORD(v14) &gt;&gt; 31)) &amp; 1)
                - (SHIDWORD(v14) &gt;&gt; 31);
      v14 /= 2LL;
    }
    for ( j = 50; j &gt;= 0; --j )
    {
      if ( v2[j] )
      {
        if ( v2[j] == 1 )
        {
          putchar('*');
          ++v15;
        }
      }
      else
      {
        putchar(' ');
        ++v15;
      }
      if ( !(v15 % 5) )
        putchar(' ');
    }
    result = putchar('\n');
  }
  return result;
}
</code></pre>
<p>大致意思是将v3~v12这十个数转为二进制后以两两为一组最后形成5个50位的数后比较，得出是打印&quot;*&quot;还是打印&quot; &quot;</p>
<p>脚本</p>
<pre><code>#include&lt;iostream&gt;
#include&lt;cstring&gt;
using namespace std;
int main()
{
	char a[5][50]={
	1,0,0,0,1,0,0,1,0,0,1,1,1,1,1,1,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,0,1,0,0,1,1,1,1,1,1,0,0,0,1,1,0,0,0,1,
	1,0,0,0,1,0,1,0,1,0,1,0,0,0,0,1,0,0,1,0,0,0,1,0,0,0,0,1,0,0,1,0,1,0,0,1,0,0,0,0,1,0,0,0,1,1,1,0,0,1,
	1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,1,1,1,0,0,0,0,1,0,0,0,0,1,0,0,1,1,1,1,1,1,1,1,0,0,1,0,0,0,1,1,0,1,0,1,
	1,0,0,0,1,1,0,0,0,1,1,0,0,0,0,1,0,1,1,0,0,0,1,0,0,0,0,1,0,0,0,0,1,0,0,1,0,0,0,0,1,0,0,0,1,1,0,0,1,1,
	1,0,0,0,1,1,0,0,0,1,1,1,1,1,1,1,0,0,0,1,1,1,1,1,1,0,0,1,0,0,0,0,1,0,0,1,0,0,0,0,1,1,1,1,1,1,0,0,0,1};
	int v15=0;
	for(int i=0;i&lt;5;i++)
	{
	for(int j=0;j&lt;50;j++)
	{
		if(a[i][j]==1)
		{
		cout&lt;&lt;&quot;*&quot;;
		++v15;
		}
		else
		{
		cout&lt;&lt;&quot; &quot;;
		++v15;
	}
		if(!(v15%5))
		cout&lt;&lt;&quot; &quot;;
	}
	cout&lt;&lt;endl;
}
 } 

</code></pre>
<figure data-type="image" tabindex="1"><img src="https://7usai.github.io/post-images/1602690295809.png" alt="" loading="lazy"></figure>
<h2 id="vn2020-公开赛csre">[V&amp;N2020 公开赛]CSRe</h2>
<p>de4dot .\CSRe.exe脱壳，放入dnspy</p>
<p>主函数</p>
<pre><code>// Class3
// Token: 0x0600000F RID: 15 RVA: 0x00002374 File Offset: 0x00000574
private static void Main(string[] args)
{
	if (!Class1.smethod_1())
	{
		return;
	}
	bool flag = true;
	Class3 @class = new Class3();
	string str = Console.ReadLine();
	if (Class3.smethod_0(&quot;3&quot; + str + &quot;9&quot;) != &quot;B498BFA2498E21325D1178417BEA459EB2CD28F8&quot;)
	{
		flag = false;
	}
	string text = Console.ReadLine();
	string string_ = Class3.smethod_0(&quot;re&quot; + text);
	string text2 = @class.method_0(string_, &quot;63143B6F8007B98C53CA2149822777B3566F9241&quot;);
	for (int i = 0; i &lt; text2.Length; i++)
	{
		if (text2[i] != '0')
		{
			flag = false;
		}
	}
	if (flag)
	{
		Console.WriteLine(&quot;flag{&quot; + str + text + &quot;}&quot;);
	}
}
</code></pre>
<p>大致意思是flag中是由str和text组成的，3+str+9经过smethod_0加密后为一个已知字符串，re+text加密后同理</p>
<p>进入smethod_0函数</p>
<pre><code>	public static string smethod_0(string string_0)
	{
		byte[] bytes = Encoding.UTF8.GetBytes(string_0);
		byte[] array = SHA1.Create().ComputeHash(bytes);
		StringBuilder stringBuilder = new StringBuilder();
		foreach (byte b in array)
		{
			stringBuilder.Append(b.ToString(&quot;X2&quot;));
		}
		return stringBuilder.ToString();
	}
</code></pre>
<p>为一个sha1加密函数，在线解密后得flag</p>
<h2 id="actf新生赛2020usualcrypt">[ACTF新生赛2020]usualCrypt</h2>
<p>主函数</p>
<pre><code>int __cdecl main(int argc, const char **argv, const char **envp)
{
  int v3; // esi
  int result; // eax
  int v5; // [esp+8h] [ebp-74h]
  int v6; // [esp+Ch] [ebp-70h]
  int v7; // [esp+10h] [ebp-6Ch]
  __int16 v8; // [esp+14h] [ebp-68h]
  char v9; // [esp+16h] [ebp-66h]
  char v10; // [esp+18h] [ebp-64h]

  sub_403CF8(&amp;dword_40E140);                    // 来来来give your flag
  scanf(aS, &amp;v10);                              // %s 输入字符串存入v10所在位置
  v5 = 0;
  v6 = 0;
  v7 = 0;
  v8 = 0;
  v9 = 0;
  sub_401080(&amp;v10, strlen(&amp;v10), &amp;v5);
  v3 = 0;
  while ( *(&amp;v5 + v3) == byte_40E0E4[v3] )      // v5[i]==byte_40E0E4[i]  v5为36位
  {
    if ( ++v3 &gt; strlen(&amp;v5) )
      goto LABEL_6;                             // 循环完后 goto LABEL_6
  }
  sub_403CF8(aError);
LABEL_6:
  if ( v3 - 1 == strlen(byte_40E0E4) )          // v5字符串长度和byte_40E0E4字符串长度一致
    result = sub_403CF8(aAreYouHappyYes);       // right
  else
    result = sub_403CF8(aAreYouHappyNo);
  return result;
}
</code></pre>
<p>从主函数可知加密函数位sub_401080，进入后发现是一个base64加密函数<br>
并提出来byte_40E0E4=zMXHz3TIgnxLxJhFAdtZn2fFk3lYCrtPC2l9</p>
<p>base64加密函数</p>
<pre><code>// base64加密
int __cdecl sub_401080(int a1, int a2, int a3)
{
  int v3; // edi
  int v4; // esi
  int v5; // edx
  int v6; // eax
  int v7; // ecx
  int v8; // esi
  int v9; // esi
  int v10; // esi
  int v11; // esi
  _BYTE *v12; // ecx
  int v13; // esi
  int v15; // [esp+18h] [ebp+8h]

  v3 = 0;
  v4 = 0;
  sub_401000();                                 // len(v10)=36
  v5 = a2 % 3;                                  // v5=len(v10)%3
  v6 = a1;                                      // v6=v10
  v7 = a2 - a2 % 3;                             // v7=len(v10)-len(v10)%3
  v15 = a2 % 3;                                 // v15=len(v10)%3
  if ( v7 &gt; 0 )
  {
    do
    {
      LOBYTE(v5) = *(a1 + v3);
      v3 += 3;
      v8 = v4 + 1;
      *(v8++ + a3 - 1) = byte_40E0A0[(v5 &gt;&gt; 2) &amp; 0x3F];// a3=main_v5  a3[0]=
      *(v8++ + a3 - 1) = byte_40E0A0[16 * (*(a1 + v3 - 3) &amp; 3) + ((*(a1 + v3 - 2) &gt;&gt; 4) &amp; 0xF)];// a3[1]=
      *(v8 + a3 - 1) = byte_40E0A0[4 * (*(a1 + v3 - 2) &amp; 0xF) + ((*(a1 + v3 - 1) &gt;&gt; 6) &amp; 3)];// a3[2]=
      v5 = *(a1 + v3 - 1) &amp; 0x3F;
      v4 = v8 + 1;
      *(v4 + a3 - 1) = byte_40E0A0[v5];
    }
    while ( v3 &lt; v7 );
    v5 = v15;
  }
  if ( v5 == 1 )
  {
    LOBYTE(v7) = *(v3 + a1);
    v9 = v4 + 1;
    *(v9 + a3 - 1) = byte_40E0A0[(v7 &gt;&gt; 2) &amp; 0x3F];
    v10 = v9 + 1;
    *(v10 + a3 - 1) = byte_40E0A0[16 * (*(v3 + a1) &amp; 3)];
    *(v10 + a3) = 61;
LABEL_8:
    v13 = v10 + 1;
    *(v13 + a3) = 61;
    v4 = v13 + 1;
    goto LABEL_9;
  }
  if ( v5 == 2 )
  {
    v11 = v4 + 1;
    *(v11 + a3 - 1) = byte_40E0A0[(*(v3 + a1) &gt;&gt; 2) &amp; 0x3F];
    v12 = (v3 + a1 + 1);
    LOBYTE(v6) = *v12;
    v10 = v11 + 1;
    *(v10 + a3 - 1) = byte_40E0A0[16 * (*(v3 + a1) &amp; 3) + ((v6 &gt;&gt; 4) &amp; 0xF)];
    *(v10 + a3) = byte_40E0A0[4 * (*v12 &amp; 0xF)];
    goto LABEL_8;
  }
LABEL_9:
  *(v4 + a3) = 0;
  return sub_401030(a3);                        // 大小写转化函数
}
</code></pre>
<p>在这个加密函数中调用了两个函数sub_401000和sub_401030，其中后者为大小写转化函数，过于简单，不分析</p>
<p>sub_401000</p>
<pre><code>signed int sub_401000()
{
  signed int result; // eax
  char v1; // cl

  result = 6;
  do
  {
    v1 = byte_40E0AA[result];
    byte_40E0AA[result] = byte_40E0A0[result];
    byte_40E0A0[result++] = v1;
  }
  while ( result &lt; 15 );
  return result;
}
</code></pre>
<p>易知byte_40E0A0=ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/<br>
byte_40E0AA=KLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/<br>
这里相当于从两个byte数组下标为6的地方开始到下标为14的地方结束，进行互换，互换后的结果为此时的byte_40E0A0<br>
我们需要得到互换之前的base64对照表</p>
<p>大致意思是flag经过之前的base64对照表转换，再经过大小写转换得到byte_40E0E4=zMXHz3TIgnxLxJhFAdtZn2fFk3lYCrtPC2l9</p>
<h3 id="脚本思路">脚本思路</h3>
<p>先对byte_40E0E4进行大小写转换，再获得之前的base64对照表，再通过对照表将新的byte_40E0E4转换为flag的base64值，再解密base64</p>
<p>脚本</p>
<pre><code>import base64
flag = ''; dict = {};
orgin = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/'
for i in range(len(orgin)):
    dict[orgin[i]] = orgin[i]
for i in range(6, 15): 
    dict[orgin[i]] , dict[orgin[i+10]] = dict[orgin[i+10]] , dict[orgin[i]] # 恢复base64密钥表
print(dict)
secret = 'zMXHz3TIgnxLxJhFAdtZn2fFk3lYCrtPC2l9'.swapcase() #sub_401030()大小写转换
for i in range(len(secret)):
    flag += dict[secret[i]]#根据恢复后的base64密钥表进行部分字符转化，想到于G~O的字符转为Q~Y,Q~Y转为G~o
print(flag)
flag = base64.b64decode(flag)
print(flag)

#恢复base64密钥表相当于以下算法
secret1 = 'zMXHz3TIgnxLxJhFAdtZn2fFk3lYCrtPC2l9'.swapcase()
a=''
for i in range(len(secret1)):
    if ord(secret1[i])&lt;80 and ord(secret1[i])&gt;=71:
        a += chr(ord(secret1[i]) + 10)
    else:
        if ord(secret1[i])&lt;90 and ord(secret1[i])&gt;=81:
            a += chr(ord(secret1[i]) - 10)
        else:
            a += chr(ord(secret1[i]))
print(a)
</code></pre>
 </p>
                    </div>
                </div>

                <div class="row">
                    <div class="col-md-12 animate-box">
                        
                            <div class="next-post">
                                <div class="next">下一篇</div>
                                <a href="https://7usai.github.io/post/jU8l_PwBM/">
                                    <h3 class="post-title">
                                        BUUCTF re部分wp_2
                                    </h3>
                                </a>
                            </div>
                        
                    </div>
                </div>

                <div class="row">
    <div class="col-md-12 animate-box">
        
    </div>
</div>

            </div>

        </article>
    </div>
</div>

    

    <!-- 返回顶部 -->
    <div class="back-to-top">
    
        <a href="#!" id="tool-toc" class="hidden-xs hidden-sm">
            <i class="fa fa-map"></i>
        </a>
        <br>
    
    <a href="#top" class="hidden-xs hidden-sm"><i class="fa fa-paper-plane"></i></a>
</div>

<div class="post-toc animated fadeInRight hidden-xs hidden-sm" style="display: none;">
    <ul class="markdownIt-TOC">
<li>
<ul>
<li><a href="#guet-ctf2019re">[GUET-CTF2019]re</a></li>
<li><a href="#flareon4login">[FlareOn4]login</a></li>
<li><a href="#actf%E6%96%B0%E7%94%9F%E8%B5%9B2020rome">[ACTF新生赛2020]rome</a></li>
<li><a href="#vn2020-%E5%85%AC%E5%BC%80%E8%B5%9Bstrangecpp">[V&amp;N2020 公开赛]strangeCpp</a></li>
<li><a href="#bjdctf2020easy">[BJDCTF2020]easy</a></li>
<li><a href="#vn2020-%E5%85%AC%E5%BC%80%E8%B5%9Bcsre">[V&amp;N2020 公开赛]CSRe</a></li>
<li><a href="#actf%E6%96%B0%E7%94%9F%E8%B5%9B2020usualcrypt">[ACTF新生赛2020]usualCrypt</a>
<ul>
<li><a href="#%E8%84%9A%E6%9C%AC%E6%80%9D%E8%B7%AF">脚本思路</a></li>
</ul>
</li>
</ul>
</li>
</ul>

</div>


    
<footer id="fh5co-footer">
  <p>Powered by <a href="https://github.com/getgridea/gridea" target="_blank">Gridea</a></p>
</footer>


    <!-- jQuery -->
<script src="https://7usai.github.io/media/scripts/jquery.min.js"></script>
<!-- img lazy load -->
<script src="https://7usai.github.io/media/scripts/jquery.lazyload.min.js"></script>
<!-- jQuery Easing -->
<script src="https://7usai.github.io/media/scripts/jquery.easing.1.3.js"></script>
<!-- Bootstrap -->
<script src="https://7usai.github.io/media/scripts/bootstrap.min.js"></script>
<!-- Waypoints -->
<script src="https://7usai.github.io/media/scripts/jquery.waypoints.min.js"></script>
<!-- Main JS -->
<script src="https://7usai.github.io/media/scripts/main.js"></script>
<!-- Md5 Min JS -->
<script src="https://7usai.github.io/media/scripts/md5.min.js"></script>
<!-- katex -->
<!--<script src="https://cdn.bootcss.com/KaTeX/0.11.1/katex.min.js"></script>-->
<!-- highlight -->
<script src="https://cdn.bootcss.com/highlight.js/9.15.8/highlight.min.js"></script>


<script type="application/javascript">
    // 代码高亮
    hljs.initHighlightingOnLoad();

    // img 懒加载
    $(function () {
        $("img.lazy").lazyload({
            effect: "fadeIn",  // 懒加载动画
            threshold: 180  // 在图片距离屏幕180px时提前载入
        });
        // tooltip
        $('[data-toggle="tooltip"]').tooltip();

        // 目录
        $('#tool-toc').click(function () {
            $('.post-toc').toggle();
        });
    });

    
        var allImg = $("img");
        allImg.on("contextmenu", function () {
            return false;
        });
        allImg.on("dragstart", function () {
            return false;
        });
    
</script>




</body>
</html>
